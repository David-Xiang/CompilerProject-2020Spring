以case10为例。

`A<8, 8>[i, j] = (B<10, 8>[i, j] + B<10, 8>[i + 1, j] + B<10, 8>[i + 2, j]) / 3.0;`

可以构建表达式树如下：

            A[i,j]   =   ( / )
                        /     \
                      ( + )    3.0
                    /      \
                  ( + )    B[i + 2, j]
                /     \
              B[i, j]  B[i + 1, j]        


表达式树的每一个节点都是一个运算符，其连接着若干个操作数。对运算符op，记对应的运算为`z = op (x,y)`，当给定最终输出关于`z`的梯度$\frac{\partial L}{\partial z}$后，我们需要将梯度的信息沿着这个节点传递到表达式树的下端，也就是说，我们需要计算：
$$
    \frac{\partial L}{\partial x} = op1 (x,y,\frac{\partial L}{\partial z}) = \frac{\partial L}{\partial z} * \frac{\partial z}{\partial x}
$$
和
$$
    \frac{\partial L}{\partial y} = op2 (x,y,\frac{\partial L}{\partial z}) = \frac{\partial L}{\partial z} * \frac{\partial z}{\partial y}
$$
对于case10，假设我们已知最终的函数关于A的梯度dA, 对于根节点运算符`/`，记$z = x/y$，我们有
$$
    dx = dz/y
$$
且
$$
    dy = - \frac{x}{y^2} * dz
$$
利用这两个法则，可以将梯度传递到根节点的两个儿子。其右边的儿子的梯度为`-\frac{val(+)}/{3.0}^2 dA`。左边的儿子是另一个运算符`+`，利用求导法则，我们可以得到最终输出关于`+`节点的导数为$dA/3.0$。

接下来继续这个过程，将梯度沿着`+`节点传到表达式树的下端。对于`z=x+y`而言，我们有
$$
    dx = dz, dy = dz
$$
利用这个简单的法则，我们知道，对于这个`+`的右儿子，有`dB = dA/3.0`, 添加上指标信息就是`dB[i+2,j] = dA[i,j]/3.0`。对于这个`+`的左儿子，同样其梯度为`dA/3.0`。再继续这个过程。对第二个`+`，继续将梯度传到左右儿子，分别得到`dB[i,j] = dA[i,j]/3.0`和`dB[i+1,j] = dA[i,j]/3.0`。

我们将梯度沿着表达式树传递到底端后，只需要看所有叶子节点，将所求的梯度**累加**起来即可。也就是先初始化`dB[i,j]=0`，然后执行：`dB[i,j] += dA[i,j]/3.0`,`dB[i+1,j] += dA[i,j]/3.0`和`dB[i+2,j] += dA[i,j]/3.0`.

综上，我们得到了三条累加式：

    dB[i,j] += dA[i,j]/3.0
    dB[i+1,j] += dA[i,j]/3.0
    dB[i+2,j] += dA[i,j]/3.0

下一步，我们需要对表达式左端的指标进行化简。引入一个新的变量`u`并令`u=i+1`，由于新变量`u`的引入，我们可以反过来将表达式中的一个变量用剩余的变量表示出来。这里只有`i`一个变量（而case6中有两个），我们计算出`i=u-1`，并将其回代入该累加式的所有部分，得到`dB[u,j] += dA[u-1,j]/3.0`。同时注意需要对`u`和`u-1`的取值范围进行推断。